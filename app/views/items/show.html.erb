<%= render partial: 'search', locals: { item: @item } %>

<div class="row">
  <% unless @item.image.blank? %>
    <div class="image">
      <%= image_tag(@item.image) %>
    </div>
  <% end %>

  <div class="properties">
    <table>
      <tbody>
        <% item_properties(@item) do |key, value| %>
          <tr>
            <td><%= key %>:</td>
            <td><%= value %></td>
          </tr>
        <% end %>
      </tbody>
    </table>
  </div>
</div>

<div class="row">
  <div class="orders">
    <% if @item.orders(true).any? %>
      <table data-sort class="hover">
        <thead>
          <tr>
            <th data-sort><%= t("activerecord.attributes.order.price") %></th>
            <th data-sort data-sort-desc><%= t("activerecord.attributes.order.quality") %></th>
            <th></th>
          </tr>
        </thead>
        <tbody>
          <% @item.orders(true).available.each do |order| %>
            <tr>
              <td data-sort-value="<%= order.price %>"><%= order.price %>kr</td>
              <td class="quality" data-sort-value="<%= order.quality %>"><%= stars(order.quality) %></td>
              <td><%= link_to(t(:show, rescue_format: nil), [order.item, order], class: 'button') %></td>
            </tr>
          <% end %>
        </tbody>
      </table>
    <% else %>
      <% if @item.alternative.blank? %>
        <%= t(:no_one_is_selling, name: @item.name) %>
      <% else %>
        <%= t(:no_one_is_selling_with_alternative_html, name: @item.name, alternative: alternative_link(@item)) %>
      <% end %>
    <% end %>
  </div>

  <div class="new-order">
    <% if signed_in? %>
      <%= form_for([@item, @order], html: { class: 'form' }) do |f| %>
        <fieldset>
          <legend><%= t(:place_sell_order) %></legend>
          <% @order.errors.full_messages.each do |msg| %>
            <%= msg %>
          <% end %>
          <%= f.label :price %>
          <%= telephone_field(:order, :price) %>
          <%= f.label :quality %>
          <div class="quality">
            <%= f.radio_button(:quality, "3") %>
            <%= f.label(:quality_3, "&#9733;".html_safe) %>
            <%= f.radio_button(:quality, "2", checked: true) %>
            <%= f.label(:quality_2, "&#9733;".html_safe) %>
            <%= f.radio_button(:quality, "1") %>
            <%= f.label(:quality_1, "&#9733;".html_safe) %>
          </div>
          <%= f.submit(class: 'button') %>
        </fieldset>
      <% end %>
    <% else %>
      <% if @item.orders(true).any? %>
        <%= link_to t(:must_be_signed_in_to_sell_or_buy, item: @item.name), sign_in_user_path %>
      <% else %>
        <%= link_to t(:must_be_signed_in_to_sell, item: @item.name), sign_in_user_path %>
      <% end %>
    <% end %>
  </div>
</div>
